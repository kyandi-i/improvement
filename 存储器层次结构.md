# 存储器层次结构

---

存储器—计算机系统硬件系统下的一部分：用于存放程序和数据，分为主存储器（内存）和辅助存储器（硬盘，U盘等）

### 1、存储技术

#### 1.1随机访问存储器

​	随机访问存储器（RAM）可以分为两类：

* ##### 静态RAM

	SRAM将每个位存储在一个双稳态的(bistable)存储器单元里面。每个单元又是用一个六晶体管电路来实现。
	特点：可无限期保持在两个不同电压配置或状态之一。（双稳态特性）

	![](C:\Users\Lenovo\Pictures\Camera Roll\SRAM.png)

	

* ##### 动态RAM

	DRAM将每个位存储为对一个电容的充电。这个电容很小，大约只有30毫微微法拉。DRAM存储器可以制造的非常密集，每个单元都由一个电容和一个访问晶体组成。
	DRAM存储器单元对干扰非常敏感，当电容电压被扰乱后，将不会再恢复，暴露在光线下会导致电容电压改变。实际上数码照相机和摄像机中传感器本质上就是DRAM单元的阵列。

	<img src="C:\Users\Lenovo\Pictures\Camera Roll\CELL.png" style="zoom: 33%;" />

	<img src="C:\Users\Lenovo\Pictures\Camera Roll\CELL列阵.png" style="zoom:50%;" />

	[深入学习DRAM](https://blog.csdn.net/qq_41554005/article/details/134234240)

	|      | 每位晶体管数 | 相对访问时间 | 持续 | 敏感 | 相对花费 |      应用      |
	| ---- | ------------ | ------------ | ---- | ---- | -------- | :------------: |
	| SRAM | 6            | 1*           | Y    | N    | 1000*    | 高速缓存存储器 |
	| DRAM | 1            | 10*          | N    | Y    | 1*       | 主存，帧缓冲区 |

* ##### 内存模块

	DRAM芯片封装在内存模块中，它插到主板的扩展槽上。常用的是双列直插内存模块(DIMM)，以64位为块与内存控制器交换数据。

	比如一个内存模块包含 8 个 DRAM 芯片，每个 DRAM 包含 8M 个超单元，每个超单元存储一个字节。使用 8 个 DRAM 芯片上相同地址处的超单元来表示一个 64 位字，DRAM 0 存储第一个字节，DRAM 1 存储第 2 个字节，依此类推。![](C:\Users\Lenovo\Pictures\Camera Roll\DRAM内存模板.png)

	要取出内存地址 A 处的一个字，内存控制器先将 A 转换为一个超单元地址 (i,j)，然后内存模块将 i,j 广播到每个 DRAM。作为响应，每个 DRAM 输出它的 (i,j) 超单元的 8 位内容，合并成一个 64 位字，再返回给内存控制器。此外，主存由多个内存模块连接到内存控制器聚合成。

* ##### 增强的DRAM

	* 快页模式 DRAM (Fast Page Mode DRAM,FPM DRAM)：当连续访问位于同一行的超单元时，第二次以后，FPM DRAM 可以直接从行缓冲区获取数据。
	* 扩展数据输出 DRAM (Extended Data Out DRAM,EDO DRAM)：FPM DRAM 的一个增强的形式，更快一些。
	* 同步 DRAM (Synchronous DRAM,SDRAM)：常规的、FPM 和 EDO 都是异步的。从效果而言，SDRAM 可以比异步存储器更快地输出它的超单元的内容。
	* 双倍数据速率同步 DRAM(Double Data-Rate SDRAM,DDR SDRAM)：对 SDRAM 的一种增强，使速度翻倍。不同的 DDR SDRAM 以提高有效带宽的很小的预留缓冲区的大小来划分：DDR(2位)、DDR2(4位)、DDR3(8位)。位越多速度越快，近乎翻倍。
	* 视频 RAM (VRAM)：用在图形系统的帧缓冲区中，其思想与 FPM DRAM 类似。VRAM 允许对内存进行并行地读和写。因此系统可以在写下一次更新的新值时（写），用帧缓冲区的像素刷屏幕（读）。

* ##### 非易失性存储器

	* DRAM 和 SRAM 会在断电后丢失信息，因此是易失性存储器。ROM 是非易失性存储器，在断电后仍保存着信息。
	* ROM 是只读存储器，但是实际上有些 ROM 既可以读也可以写。
	* 几种常见的非易失性存储器：
		* 可编程 ROM (PROM)：只能被编程一次。
		* 可擦写可编程 ROM (EPROM)：可以被擦除和重编程上千次。
		* 电子可擦除 PROM (EEPROM)：类似于 EPROM，但是可以被重编程十万次。
		* 闪存：基于 EEPROM 的一种存储技术。闪存无处不在，固态硬盘就是一种基于闪存的磁盘驱动器。
		* 存储在 ROM 设备中的程序通常称为固件，当计算机系统通电后，会运行存储在 ROM 中的固件。(BIOS程序存储在固件中)

* 访问主存

	* 数据流通过总线在处理器与主存间来往，每次处理器和主存间的数据传送的一系列步骤称为总线事务。

	* 总线是一组并行的导线，能携带地址、数据和控制信号。

	* 系统总线连接 CPU 和 IO 桥接器，内存总线连接 IO 桥接器和主存。IO 桥同时也连接着 I/O 总线。![IMG_20251017_151726](D:\qq files\office__\IMG_20251017_151726.png)

	* 读事物的三个步骤

		* CPU 将地址 A 放到内存总线上。
		* 主存从总线读出 A，取出字 x，然后将 x 放到总线上。
		* CPU 从总线读出字 x，并将它复制到相应寄存器中。![IMG_20251017_151605](D:\qq files\office__\IMG_20251017_151605.png)

	* 写事物的三个步骤

		* CPU 将地址 A 放到内存总线。主存读出这个地址，并等待数据字。

		* CPU 将数据字 y 放到总线上。

		* 主存从总线读数据字 y，并将它存储在地址 A。![IMG_20251017_151621](D:\qq files\office__\IMG_20251017_151621.png)

			---

#### 1.2、磁盘存储

##### 1.磁盘构造

* 磁盘由==盘片==组成，每个盘片有两个==表面==，表面上覆盖着磁性记录材料。一个磁盘包含一个或多个盘片。
* 每个表面由多个同心圆（称为==磁道==）组成，每个磁道被划分为一组扇区，每个扇区包含相同的数据位（一般为512字节）。
* ==扇区==之间由==间隙==分隔开，间隙中不存储数据位，而存储用来标识扇区的格式化位。
* 名词柱面用来表示距离主轴相等的磁道的集合。比如一个磁盘有 3 个盘片，那么每个柱面就有 6 个磁道。

![](C:\Users\Lenovo\Pictures\Camera Roll\磁盘.png)

##### 2.磁盘容量

决定磁盘容量的因素：

* 记录密度：磁道一英寸的段中可以放入的位数。

* 磁道密度：从盘片中心出发半径上一英寸的段内可以有的磁道数。

* 面密度：记录密度与磁道密度的乘积。

	> 现代大容量磁盘使用一种称为多区记录技术，即柱面的集合被分割成不相交的集合，称为记录区。每个区包含一组连续的柱面。磁盘格式化会填写间隙、标识出有故障的柱面、在每个区中预留出一组柱面作为备用。所以格式化容量要比最大容量小。

##### 3.磁盘操作

* 磁盘用读写头来读写存储在磁性表面的位。每个表面都有一个读写头，任何时候所有的读写头都位于同一个柱面上。
* 磁盘读写数据时以扇区为主，即一次读写一个扇区大小的块

##### 4.逻辑磁盘块

* 现代磁盘呈现为一个逻辑块的序列，每个逻辑块大小为一个扇区，即 512 字节。
* 当操作系统读写磁盘时，发送一个逻辑块号到磁盘控制器（维护着逻辑块号和实际（物理）磁盘扇区之间的映射关系），控制器上的固件将逻辑块号翻译为一个（盘面、磁道、扇区）的三元组。

##### 5.连接I/O设备

* 系统总线与内存总线都是与CPU相关的，而I/O总线与CPU无关。
	* Intel的外部设备互连总线（PCI）就是一种IO总线。

* IO 总线速度相比于系统总线和内存总线慢，但是可以容纳种类繁多的第三方 IO 设备。
	* 通用串行总线（USB）：USB 总线是一个广泛使用的标准，连接各种 IO 设备，包括键盘、鼠标等。
	* 显卡/显示适配器：负责代表 CPU 在显示器上画像素。
	* 主机总线适配器：连接磁盘。常总的磁盘接口是 SCSI 和 SATA。其中 SCSI 比 SATA 更快也更贵。

![](C:\Users\Lenovo\Pictures\Camera Roll\IO设备.png)

##### 6.访问磁盘

* **CPU 使用内存映射 IO 技术来向 IO 设备发射命令**。在使用内存映射 IO 的系统中，**地址空间中有一块地址是专为与 IO 设备通信保留的，每个这样的地址称为一个 IO 端口**。当一个设备连接到总线时，它与一个或多个端口相关联。

* 假设磁盘控制器映射到端口 0xa0，读一个磁盘扇区的步骤如下：

	* CPU 依次发送命令字、逻辑块号、目的内存地址到 0xa0，发起一个磁盘读。因为磁盘读的时间很长，所以此后 CPU 会转去执行其他工作。
	* 磁盘收到读命令后，将逻辑块号翻译成一个扇区地址，读取该扇区的内容，并将内容直接传送到主存，不需要经过 CPU (这称为直接内存访问(DMA))。
	* DMA 传送完成后，即磁盘扇区的内容安全地存储在主存中后，磁盘控制器给 CPU 发送一个中断信号来通知 CPU。![](C:\Users\Lenovo\Pictures\Camera Roll\访问磁盘.png)

	#### 1.3、固态硬盘

	##### 固态硬盘（SSD）是一种基于闪存的存储技术。![](C:\Users\Lenovo\Pictures\Camera Roll\磁盘1.png)

* 一个固态硬盘中封装了一个**闪存翻译层**和多个**闪存芯片**。闪存翻译层是一个硬件/固件设备，功能类似**磁盘控制器**，将对逻辑块的请求翻译成对底层物理设备的访问。

* 一个闪存由 `B` 个块的序列组成，每个块由 `P` 页组成，页的大小为 `512byte~4kb`。**数据以页为单位进行读写**。

* 对于 SSD 来说，读比写快。因为只有在一页所属的块整个被擦除后，才能写这一页。重复写十万次后，块就会磨损，因此固态硬盘寿命较低。

	##### 随机写SSD很慢的两个原因：

* 擦除块需要相对较长的时间。

* 如果写操作试图修改一个已经有数据的页，那么这个块中所有带有用数据的页都必须复制到一个新的块，然后才能向该页写数据。

	##### SSD相比于旋转磁盘的优缺点：

* 优点：由半导体存储器构成，没有移动部件，所以**更结实，随机访问也更快，能耗更低**。

* 缺点：**更容易磨损**，不过现在的 SSD 已经可以用很多年了。

	##### 一个商业硬盘的性能特性:

	![](C:\Users\Lenovo\Pictures\Camera Roll\Intel SSD.png)

	### 1.4、存储技术趋势

* 性能上：**SRAM** > **DRAM** > **SSD** > **旋转磁盘**

* 发展速度：**增加密度（降低成本）**> **降低访问时间**

近年来磁盘、DRAM和CPU速度之间差距

![](C:\Users\Lenovo\Pictures\Camera Roll\差距图.png)

* DRAM 和 磁盘的性能滞后于 CPU 的性能提升速度，两者之间的差距越来越大。
* 有效CPU周期时间：一个单独的CPU的周期时间除以它的处理器核心数
* CPU性能曲线在2003年附近的突然变化反映的是多核处理器的出现（2004年出现双核处理器，2007年出现四核处理器），在这个分割点之后，可以看到单个核的周期时间（单核性能）变化不大，而多核性能持续上升

### 思考：

在未来存储技术将会在哪方面性能有更多的提升，理想中的储存技术应该是什么样的？